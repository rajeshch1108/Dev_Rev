<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="raj_logo.png">
    <title>History Page</title>
    <script src="https://kit.fontawesome.com/265aaa2447.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="userhome.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="flights.css">
    <link rel="stylesheet" href="viewbooking.css">
</head>
<body>
    <header>
        <img src="raj_logo.png">
    </header>

    <div id="list-container">
        <table class="table">
            <thead class="thead">
                <th>S.no</th>
                <th>Email</th>
                <th>From</th>
                <th>To</th>
                <th>Flight Name</th>
                <th>Flight Id</th>
                <th>No of Seats Booked</th>
            </thead>
            <tbody id="tbody1"></tbody>
        </table>
    </div>

    <script>
        var sidemenu = document.getElementById('sidemenu');

        function openMenu(){
            sidemenu.style.left = "0";
        }

        function closeMenu(){
            sidemenu.style.left = "-280px";
        }
    </script>
</body>

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

    import { update, getDatabase, ref, child, onValue, get, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js"
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDdbV0ca3tQKg-eE4MlL2dcPMhpzIdtcf8",
        authDomain: "devrev-7d849.firebaseapp.com",
        databaseURL: "https://devrev-7d849-default-rtdb.firebaseio.com/",
        projectId: "devrev-7d849",
        storageBucket: "devrev-7d849.appspot.com",
        messagingSenderId: "503286320703",
        appId: "1:503286320703:web:5947cd2198e0b7ff49328a"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);

    const db = getDatabase();
    

    var sNo = 0;
    var tbody = document.getElementById('tbody1');
    function AddItemsToTable(email, from, to, flightName, flightID, seats){
        let trow = document.createElement("tr");
        let td1 = document.createElement('td');
        let td2 = document.createElement('td');
        let td3 = document.createElement('td');
        let td4 = document.createElement('td');
        let td5 = document.createElement('td');
        let td6 = document.createElement('td');
        let td7 = document.createElement('td');

        td1.innerHTML = ++sNo;
        td2.innerHTML = from;
        td3.innerHTML = to;
        td4.innerHTML = flightName;
        td5.innerHTML = flightID;
        td6.innerHTML = seats;
        td7.innerHTML = email

        
        trow.appendChild(td1);
        trow.appendChild(td7);
        trow.appendChild(td2);
        trow.appendChild(td3);
        trow.appendChild(td4);
        trow.appendChild(td5);
        trow.appendChild(td6);

        tbody.append(trow);
    }


    function AddAllItemsToTable(History){
        sNo = 0;
        tbody.innerHTML = "";
        History.forEach(element => {
            AddItemsToTable(element.email, element.from, element.To, element.FlightName, element.FlightId, element.Seats);
        });
    }

    function GetAllDataOnce(){
        const dbRef = ref(db);

        get(child(dbRef, "History"))
        .then((snapshot) => {
            var history = []

            snapshot.forEach(childSnapShot => {
                history.push(childSnapShot.val());
            });

            AddAllItemsToTable(history)
        })
    }

    function GetAllDataRealTime(){
        const dbRef = ref(db, "History");

        onValue(dbRef, (snapshot) => {
            var history = []

            snapshot.forEach(childSnapShot => {
                history.push(childSnapShot.val());
            });

            AddAllItemsToTable(history)
        })
    }

    window.onload = GetAllDataRealTime;
  </script>
</html>
